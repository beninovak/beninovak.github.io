const d=document;function Select3_openSelect3(e,t,l){e.dispatchEvent(new Event("select3:opening")),t.classList.add("opened"),t.classList.add("opened"),t.setAttribute("data-opened","1");let n=t.querySelector(".inner"),s=n.scrollHeight;s=s>l?l:s,n.style.maxHeight=s+"px",n.classList.remove("drop-up");let a=window.innerHeight-n.getBoundingClientRect().top;n.offsetHeight>=a&&n.classList.add("drop-up"),e.dispatchEvent(new Event("select3:open"))}function Select3_closeSelect3(e,t){e.dispatchEvent(new Event("select3:closing")),t.classList.remove("opened");let l=t.querySelector(".inner");t.classList.remove("opened"),t.setAttribute("data-opened","0"),l.style.maxHeight="0px",null!==t.querySelector("input.search")&&(t.querySelector("input.search").value=""),t.querySelector(".no-results")?.remove();for(let e of t.querySelectorAll(".option-hidden"))e.classList.remove("option-hidden");e.dispatchEvent(new Event("select3:close"))}function Select3_openCloseSelect3(e,t,l={}){t.classList.contains("opened")?Select3_closeSelect3(e,t):Select3_openSelect3(e,t,l.dropdownMaxHeight)}function Select3_initKeyboard(e,t,l){const n=t.querySelectorAll(".inner span[data-value]:not(.disabled)");let s=0;n[s].classList.add("focused"),t.onkeydown=null,t.onkeydown=function(a){switch(a.keyCode){case 32:a.preventDefault(),Select3_openSelect3(e,t,l.dropdownMaxHeight);break;case 27:Select3_closeSelect3(e,t);break;case 38:"1"===t.getAttribute("data-opened")&&s>0&&(n[s].classList.remove("focused"),s--,n[s].classList.add("focused"));break;case 40:"1"===t.getAttribute("data-opened")&&s<n.length-1&&(n[s].classList.remove("focused"),s++,n[s].classList.add("focused"));break;case 13:"1"===t.getAttribute("data-opened")&&n[s].dispatchEvent(new Event("click"))}}}function Select3_appendOptions(e,t,l,n,s){let a=d.createElement("span");if(a.setAttribute("data-selected","0"),a.setAttribute("data-value",n.value.toString()),Object.keys(n.dataset).length){let e=n.dataset;for(const t in e)a.setAttribute("data-"+t,e[t])}if(""===n.value&&""===n.textContent)a.classList.add("placeholder"),a.textContent=""!==s.placeholder?s.placeholder:" ";else if(null!==s.formatOptionsFunction){let e=d.createElement("span");e.append(s.formatOptionsFunction(n)),a.innerHTML=e.innerHTML}else a.textContent=n.label.length?n.label:n.textContent;if(n.disabled&&a.classList.add("disabled"),n.selected){n.selected=!0;let l=a.cloneNode();l.classList.add("selected-top"),""===n.value&&""===n.textContent?l.textContent=s.placeholder:l.textContent=n.label.length?n.label:n.textContent,e.multiple?e.multiple&&t.selectedOptionsCount<s.maximumSelectedOptions&&(t.selectedOptionsCount++,l.prepend(Select3_getCloseBtn(e,t,s)),t.querySelector(".placeholder")?.remove(),t.prepend(l),e.dispatchEvent(new Event("change")),t.selectedOptionsCount===s.maximumSelectedOptions&&(t.classList.add("maxed"),e.dispatchEvent(new Event("select3:maxed")))):(e.value=n.value,t.querySelector(".selected-top, .placeholder")?.length?t.querySelector(".selected-top, .placeholder").replaceWith(l):(t.querySelector(".selected-top, .placeholder")?.remove(),t.prepend(l))),a.classList.add("selected"),a.setAttribute("data-selected","1")}a.addEventListener("click",()=>{if(n.disabled||e.selectedOptions.length>=s.maximumSelectedOptions&&"0"===a.getAttribute("data-selected"))return;let l=a.cloneNode();l.innerHTML=a.textContent,l.classList.add("selected-top");let o=!1;if((!e.multiple&&e.val()===l.getAttribute("data-value")||e.multiple&&e.val().includes(l.getAttribute("data-value")))&&(o=!0),e.multiple||o)e.multiple&&(o?(t.querySelector(':scope > span[data-value="'+l.getAttribute("data-value")+'"]')?.remove(),n.selected=!1,a.classList.remove("selected"),a.setAttribute("data-selected","0"),Select3_showPlaceholderIfAppropriate(e,t,s),e.dispatchEvent(new Event("select3:unselected"))):(t.insertBefore(l,t.querySelector(".inner")),n.selected=!0,a.classList.add("selected"),a.setAttribute("data-selected","1"),t.querySelector(":scope > span.placeholder")?.remove(),e.dispatchEvent(new Event("select3:selected"))),e.selectedOptions.length>=s.maximumSelectedOptions?(t.classList.add("maxed"),e.dispatchEvent(new Event("select3:maxed"))):t.classList.remove("maxed"),l.prepend(Select3_getCloseBtn(e,t,s)));else{let s=e.querySelectorAll("option");for(let e of s)e.selected=!1;let o=t.querySelectorAll(".inner span");for(let e of o)e.classList.remove("selected"),e.setAttribute("data-selected","0");n.selected=!0,e.value=n.value,t.querySelector(".selected-top, .placeholder")?.replaceWith(l),a.classList.add("selected"),a.setAttribute("data-selected","1"),e.dispatchEvent(new Event("select3:selected"))}e.dispatchEvent(new Event("change")),s.closeOnSelect&&Select3_closeSelect3(e,t)}),l.append(a)}function Select3_showPlaceholderIfAppropriate(e,t,l){if(0===e.selectedOptions.length&&""!==l.placeholder){let e=d.createElement("span");e.classList.add("placeholder"),e.textContent=l.placeholder,t.prepend(e)}}function Select3_getCloseBtn(e,t,l){let n=d.createElement("b");return n.classList.add("remove"),n.textContent="×",n.addEventListener("click",n=>{n.stopPropagation(),Select3_unselectOption(e,t,n.target.parentElement,l)}),n}function Select3_unselectOption(e,t,l,n){let s=l.getAttribute("data-value");e.querySelector('option[value="'+s+'"]').selected=!1;let a=t.querySelector('.inner span[data-value="'+s+'"]');a.classList.remove("selected"),a.setAttribute("data-selected","0"),l.remove(),Select3_showPlaceholderIfAppropriate(e,t,n),e.dispatchEvent(new Event("change"))}function Select3_filterInput(e,t,l,n,s){e=e.toUpperCase();for(let l of t){if((l.textContent||l.innerText).toUpperCase().indexOf(e)>-1?l.classList.remove("option-hidden"):l.classList.add("option-hidden"),null!==l.closest("div.optgroup")){let e=!1,t=l.parentElement.querySelectorAll("span:not(.title, .no-results)");for(let l of t)if(!l.classList.contains("option-hidden")){e=!0;break}e?l.closest("div.optgroup").classList.remove("option-hidden"):l.closest("div.optgroup").classList.add("option-hidden")}}if(""!==s.searchNoResults){let e=n.querySelectorAll("span:not(.title, .no-results, .option-hidden)");if(e.length)n.querySelector(".no-results")?.remove();else if(!e.length&&!n.querySelector(".no-results")){let e=d.createElement("span");e.classList.add("no-results"),e.textContent=s.searchNoResults,n.append(e)}}}function Select3_applyConfig(e){const t={search:!1,searchPlaceholder:"",closeOnSelect:!0,minimumInputLength:3,dropdownMaxHeight:280,maximumSelectedOptions:100,placeholder:"",searchNoResults:"",formatOptionsFunction:null};for(let l in e)t.hasOwnProperty(l)&&Select3_isOptionValid(l,e[l])&&(t[l]=e[l]);return t}function Select3_isOptionValid(e,t){switch(e){case"selected":case"disabled":case"search":case"closeOnSelect":return"boolean"==typeof t;case"minimumInputLength":case"dropdownMaxHeight":case"maximumSelectedOptions":return"number"==typeof t&&t>0;case"label":case"value":case"textContent":case"placeholder":case"searchNoResults":case"searchPlaceholder":return"string"==typeof t&&t.length>0&&t.length<1e3;case"dataset":case"children":return Array.isArray(t);case"formatOptionsFunction":return"function"==typeof t}}function Select3_initDocumentListener(){d.addEventListener("click",e=>{if(e.stopPropagation(),null===e.target.closest("div.select3"))for(let e of d.querySelectorAll("div.select3.opened"))Select3_closeSelect3(e.previousSibling,e)})}Element.prototype.Select3=function(e={}){const t=this;if("SELECT"!==t.tagName)return!1;t.hasAttribute("data-select3-initialized")&&"1"===t.getAttribute("data-select3-initialized")&&t.nextSibling?.classList.contains("select3")&&t.nextSibling.remove(),t.setAttribute("tab-index","-1"),e=Select3_applyConfig(e),t.selectedOptions.length>e.maximumSelectedOptions&&(e.maximumSelectedOptions=t.selectedOptions.length);let l=d.createElement("div");l.classList.add("select3"),l.setAttribute("tab-index","0");for(let e of t.classList)l.classList.add(e);l.addEventListener("click",n=>{if(l.querySelector(".inner")?.focus(),null===n.target.closest(".inner")){let l=n.target.closest("div.select3");Select3_openCloseSelect3(t,l,e);for(let e of d.querySelectorAll("div.select3.opened"))e.isEqualNode(l)||Select3_closeSelect3(e.previousElementSibling,e)}}),t.selectedOptions.length>e.maximumSelectedOptions&&(e.maximumSelectedOptions=t.selectedOptions.length),t.multiple?l.classList.add("multiple"):l.classList.add("single");let n=d.createElement("div");if(n.classList.add("inner"),e.search){let l=d.createElement("div");l.classList.add("search-wrapper");let s=d.createElement("input");s.classList.add("search"),s.setAttribute("type","search"),s.placeholder=e.searchPlaceholder;let a=0;s.addEventListener("keyup",l=>{t.dispatchEvent(new Event("select3:search"));let s=l.target.value.length;if(s>=e.minimumInputLength||s<a){let s=l.target.closest(".inner")?.querySelectorAll("span:not(.title, .no-results)");s.length&&Select3_filterInput(l.target.value,s,t,n,e)}a=s}),s.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),s.focus()}),l.append(s),n.prepend(l)}if(0===t.selectedOptions.length||""===t[0].value&&""===t[0].textContent){let n=d.createElement("span");n.classList.add("placeholder");let s=""!==e.placeholder?e.placeholder:" ";t.multiple||""===t[0].label||(s=t[0].label),n.textContent=s,l.querySelector("span.selected-top")?.remove(),l.prepend(n)}d.querySelector('label[for="'+t.id+'"]')?.addEventListener("click",e=>{e.preventDefault(),t.open(e)}),t.val=function(){let e=[];for(let l of t.selectedOptions)e.push(l.value);return e.length>0?t.multiple?e:e[0]:""},t.open=function(n=null){n?.stopPropagation(),Select3_openSelect3(t,l,e.dropdownMaxHeight)},t.close=function(e=null){e?.stopPropagation(),Select3_closeSelect3(t,l)},t.toggle=function(e=null){"1"===l.getAttribute("data-opened")?t.close(e):t.open(e)},t.appendOptions=function(s,a=null,o=null){if(!Array.isArray(s))throw new TypeError('Incorrect argument passed to function appendOptions! The "options" argument must be of type array.');const c={textContent:"",label:"",value:"",selected:!1,disabled:!1,dataset:[],children:[]};for(const a of s){if(!(0!==a.children?.length||a.hasOwnProperty("value")&&Select3_isOptionValid("value",a.value)))continue;let s=c;for(const e in a)c.hasOwnProperty(e)&&Select3_isOptionValid(e,a[e])&&(s[e]=a[e]);if(console.table(s),0===s.children.length){let a=d.createElement("option");for(const e in s)a[e]=s[e];(t.multiple&&l.selectedOptionsCount>=e.maximumSelectedOptions||!t.multiple&&""!==t.val())&&(s.selected=!1),t.append(a),Select3_appendOptions(t,l,n,a,e)}else{let o=d.createElement("optgroup");o.label=s.label;let i=d.createElement("div");i.classList.add("optgroup");let r=d.createElement("span");r.classList.add("title"),r.textContent=s.label,i.append(r);for(const n of a.children){let s=d.createElement("option");for(const e in n)c.hasOwnProperty(e)&&Select3_isOptionValid(e,n[e])&&(s[e]=n[e]);(t.multiple&&l.selectedOptionsCount>=e.maximumSelectedOptions||!t.multiple&&""!==t.val())&&(s.selected=!1),o.append(s),Select3_appendOptions(t,l,i,s,e)}t.append(o),n.append(i)}}l.querySelector(":scope > .placeholder")?.remove(),Select3_showPlaceholderIfAppropriate(t,l,e),Select3_initKeyboard(t,l,e)},t.clear=function(){t.dispatchEvent(new Event("select3:clearing")),t.innerHTML="",t.value="",n.querySelectorAll(":scope > :not(.placeholder, .search-wrapper)").forEach(e=>{e.remove()}),l.selectedOptionsCount=0,l.querySelectorAll(".selected-top, .placeholder")?.forEach(e=>{e.remove()}),Select3_showPlaceholderIfAppropriate(t,l,e),t.dispatchEvent(new Event("select3:clear")),t.dispatchEvent(new Event("change"))},t.destroy=function(){l.remove(),t.dispatchEvent(new Event("select3:destroy")),t.style.display="",t.removeAttribute("tab-index"),t.removeAttribute("data-select3-initialized")},l.selectedOptionsCount=0;for(let s of t.children)if("OPTION"===s.tagName)Select3_appendOptions(t,l,n,s,e);else if("OPTGROUP"===s.tagName){let a=d.createElement("div");a.classList.add("optgroup");let o=d.createElement("span");o.classList.add("title"),o.textContent=s.label,a.append(o);for(let n of s.children)Select3_appendOptions(t,l,a,n,e);n.append(a)}return l.append(n),t.style.display="none",t.parentNode.insertBefore(l,t.nextSibling),Select3_initKeyboard(t,l,e),t.setAttribute("data-select3-initialized","1"),t.dispatchEvent(new Event("select3:init")),t},Select3_initDocumentListener();
